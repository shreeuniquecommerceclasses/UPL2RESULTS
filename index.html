<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UPL Round 2 Result</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body{font-family:Arial;background:#f3f4f6;padding:20px}
    .box{max-width:700px;margin:auto;background:#fff;padding:18px;border-radius:10px;box-shadow:0 3px 10px rgba(0,0,0,0.12)}
    h1{text-align:center;margin:4px 0} h2{text-align:center;margin:2px 0 12px}
    input,button{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;box-sizing:border-box}
    button{background:#2563eb;color:#fff;border:none;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #ccc;padding:8px;text-align:center}
    th{background:#fafafa}
    #printBtn{background:#10b981;display:none;padding:10px;margin-top:10px}
  </style>
</head>
<body>
  <div class="box">
    <h1>UNIQUE PREMIERE LEAGUE (UPL)</h1>
    <h2>Round 2 Result</h2>

    <input type="text" id="seatInput" placeholder="Enter Seat Number (e.g. 101)">
    <button onclick="getResult()">Get Result</button>

    <div id="status" class="small" style="margin-top:6px;color:#444"></div>
    <div id="resultArea" style="margin-top:12px"></div>
    <button id="printBtn" onclick="printResult()">üñ®Ô∏è Print / Save PDF</button>
  </div>

<script>
  // ====== REPLACE THIS with your raw GitHub CSV URL ======
  const csvUrl = "https://raw.githubusercontent.com/shreeuniquecommerceclasses/UPL2RESULTS/refs/heads/main/results.csv";
  // =====================================================

  let students = [];
  const statusEl = document.getElementById('status');

  // load CSV from GitHub raw
  function loadFromGitHub() {
    if (!csvUrl || csvUrl.includes("PASTE_RAW_URL_HERE")) {
      statusEl.innerText = "‚ö†Ô∏è Paste your raw CSV URL into index.html (csvUrl).";
      return;
    }
    statusEl.innerText = "Loading data from GitHub...";
    fetch(csvUrl)
      .then(res => {
        if (!res.ok) throw new Error('Cannot fetch CSV ‚Äî check URL & repo is public');
        return res.text();
      })
      .then(txt => {
        Papa.parse(txt, {
          header: true,
          skipEmptyLines: true,
          complete: function(res) {
            students = res.data.map(row => ({
              SeatNumber: String(row.SeatNumber || row.roll || row.RollNo || row.Roll || "").trim(),
              Name:       String(row.Name || row.name || "").trim(),
              OCM:        String(row.OCM || row.ocm || "0").trim(),
              BK:         String(row.BK || row.bk || "0").trim(),
              Eco:        String(row.Eco || row.eco || row.Economics || "0").trim(),
              MathsSP:    String(row.MathsSP || row["Maths/SP"] || row.maths || "0").trim()
            }));
            statusEl.innerText = `‚úÖ Loaded ${students.length} records from GitHub.`;
            console.log('students sample', students.slice(0,6));
          },
          error: function(err) {
            statusEl.innerText = '‚ùå Error parsing CSV: ' + (err.message || err);
          }
        });
      })
      .catch(err => {
        statusEl.innerText = '‚ùå Fetch error: ' + (err.message || err);
      });
  }

  function normalize(v){ return String(v||'').trim().replace(/\s+/g,'').toLowerCase(); }

  function getResult() {
    const seat = document.getElementById('seatInput').value.trim();
    const resultDiv = document.getElementById('resultArea');
    const printBtn = document.getElementById('printBtn');
    resultDiv.innerHTML = ''; printBtn.style.display = 'none';

    if (!seat) { resultDiv.innerHTML = "<p style='color:red'>Enter seat number</p>"; return; }
    if (!students.length) { resultDiv.innerHTML = "<p style='color:red'>Data not loaded yet. Wait or check status above.</p>"; return; }

    const found = students.find(s => normalize(s.SeatNumber) === normalize(seat));
    if (!found) {
      // helpful hint: show first few seats
      const sample = students.slice(0,8).map(x=>x.SeatNumber).join(', ');
      resultDiv.innerHTML = `<p style="color:red">Seat "${seat}" not found. Sample loaded seats: ${sample}</p>`;
      return;
    }

    const marks = [
      parseInt(found.OCM)||0,
      parseInt(found.BK)||0,
      parseInt(found.Eco)||0,
      parseInt(found.MathsSP)||0
    ];
    const total = marks.reduce((a,b)=>a+b,0);
    const percent = ((total / (4*40))*100).toFixed(2);

    resultDiv.innerHTML = `
      <table>
        <tr><th>Seat</th><td>${found.SeatNumber}</td></tr>
        <tr><th>Name</th><td>${found.Name}</td></tr>
        <tr><th>OCM</th><td>${marks[0]}</td></tr>
        <tr><th>BK</th><td>${marks[1]}</td></tr>
        <tr><th>Eco</th><td>${marks[2]}</td></tr>
        <tr><th>Maths/SP</th><td>${marks[3]}</td></tr>
        <tr><th>Total</th><td>${total} / 160</td></tr>
        <tr><th>Percentage</th><td>${percent}%</td></tr>
      </table>
    `;
    printBtn.style.display = 'inline-block';
  }

  function printResult() {
    const printContents = document.querySelector('#resultArea').innerHTML;
    const w = window.open('','_blank','width=800,height=600');
    w.document.write(`<html><head><title>UPL Result</title><style>body{font-family:Arial;padding:20px}table{width:100%;border-collapse:collapse}th,td{border:1px solid #000;padding:8px;text-align:center}</style></head><body><h1>UNIQUE PREMIERE LEAGUE (UPL)</h1><h2>Round 2 Result</h2>${printContents}</body></html>`);
    w.document.close(); w.print();
  }

  // auto-load on page open
  loadFromGitHub();
</script>
</body>
</html>
